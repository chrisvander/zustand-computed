!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).zustandMiddleware={})}(this,(function(t){"use strict";function n(){return n=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)}var e=function(t,e){return function(r,i,o){return o.dispatch=function(n){return r((function(e){return t(e,n)}),!1,n),n},o.dispatchFromDevtools=!0,n({dispatch:function(){var t;return(t=o).dispatch.apply(t,arguments)}},e)}},r=["enabled","anonymousActionType"],i=function(t,n){return void 0===n&&(n={}),function(e,i,a){var u,c=n,s=c.enabled,f=c.anonymousActionType,d=function(t,n){if(null==t)return{};var e,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)e=o[r],n.indexOf(e)>=0||(i[e]=t[e]);return i}(c,r);try{u=null!=s&&s&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(t){}if(!u)return t(e,i,a);var l=u.connect(d),p=!0;a.setState=function(t,n,r){var o=e(t,n);return p?(l.send(void 0===r?{type:f||"anonymous"}:"string"==typeof r?{type:r}:r,i()),o):o};var v=function(){var t=p;p=!1,e.apply(void 0,arguments),p=t},h=t(a.setState,i,a);if(l.init(h),a.dispatchFromDevtools&&"function"==typeof a.dispatch){var y=a.dispatch;a.dispatch=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];y.apply(void 0,n)}}return l.subscribe((function(t){switch(t.type){case"ACTION":return"string"!=typeof t.payload?void console.error("[zustand devtools middleware] Unsupported action format"):o(t.payload,(function(t){"__setState"!==t.type?a.dispatchFromDevtools&&"function"==typeof a.dispatch&&a.dispatch(t):v(t.state)}));case"DISPATCH":switch(t.payload.type){case"RESET":return v(h),l.init(a.getState());case"COMMIT":return l.init(a.getState());case"ROLLBACK":return o(t.state,(function(t){v(t),l.init(a.getState())}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return o(t.state,(function(t){v(t)}));case"IMPORT_STATE":var n,e=t.payload.nextLiftedState,r=null==(n=e.computedStates.slice(-1)[0])?void 0:n.state;if(!r)return;return v(r),void l.send(null,e);case"PAUSE_RECORDING":return p=!p}return}})),h}},o=function(t,n){var e;try{e=JSON.parse(t)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}void 0!==e&&n(e)},a=function(t){return function(n,e,r){var i=r.subscribe;return r.subscribe=function(t,n,e){var o=t;if(n){var a=(null==e?void 0:e.equalityFn)||Object.is,u=t(r.getState());o=function(e){var r=t(e);if(!a(u,r)){var i=u;n(u=r,i)}},null!=e&&e.fireImmediately&&n(u,u)}return i(o)},t(n,e,r)}},u=function t(n){return function(e){try{var r=n(e);return r instanceof Promise?r:{then:function(n){return t(n)(r)},catch:function(t){return this}}}catch(n){return{then:function(t){return this},catch:function(e){return t(e)(n)}}}}},c=function(t,e){return function(r,i,o){var a,c=n({getStorage:function(){return localStorage},serialize:JSON.stringify,deserialize:JSON.parse,partialize:function(t){return t},version:0,merge:function(t,e){return n({},e,t)}},e),s=!1,f=new Set,d=new Set;try{a=c.getStorage()}catch(t){}if(!a)return t((function(){console.warn("[zustand persist middleware] Unable to update item '"+c.name+"', the given storage is currently unavailable."),r.apply(void 0,arguments)}),i,o);var l=u(c.serialize),p=function(){var t,e=c.partialize(n({},i())),r=l({state:e,version:c.version}).then((function(t){return a.setItem(c.name,t)})).catch((function(n){t=n}));if(t)throw t;return r},v=o.setState;o.setState=function(t,n){v(t,n),p()};var h,y=t((function(){r.apply(void 0,arguments),p()}),i,o),g=function(){if(a){s=!1,f.forEach((function(t){return t(i())}));var t=(null==c.onRehydrateStorage?void 0:c.onRehydrateStorage(i()))||void 0;return u(a.getItem.bind(a))(c.name).then((function(t){if(t)return c.deserialize(t)})).then((function(t){if(t){if("number"!=typeof t.version||t.version===c.version)return t.state;if(c.migrate)return c.migrate(t.state,t.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((function(t){var n;return h=c.merge(t,null!=(n=i())?n:y),r(h,!0),p()})).then((function(){null==t||t(h,void 0),s=!0,d.forEach((function(t){return t(h)}))})).catch((function(n){null==t||t(void 0,n)}))}};return o.persist={setOptions:function(t){c=n({},c,t),t.getStorage&&(a=t.getStorage())},clearStorage:function(){var t;null==(t=a)||t.removeItem(c.name)},getOptions:function(){return c},rehydrate:function(){return g()},hasHydrated:function(){return s},onHydrate:function(t){return f.add(t),function(){f.delete(t)}},onFinishHydration:function(t){return d.add(t),function(){d.delete(t)}}},g(),h||y}};t.combine=function(t,n){return function(){return Object.assign({},t,n.apply(void 0,arguments))}},t.devtools=i,t.persist=c,t.redux=e,t.subscribeWithSelector=a}));
